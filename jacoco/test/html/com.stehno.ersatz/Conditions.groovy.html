<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Conditions.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ersatz</a> &gt; <a href="index.source.html" class="el_package">com.stehno.ersatz</a> &gt; <span class="el_source">Conditions.groovy</span></div><h1>Conditions.groovy</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2016 Christopher J. Stehno
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.stehno.ersatz

import groovy.transform.CompileStatic

import java.util.function.Function

/**
 * A handful of request matching conditions. These are used internally by the request, when not overridden. These functions may also be used in the
 * &lt;code&gt;Request&lt;/code&gt; &lt;code&gt;condition&lt;/code&gt; methods.
 */
@CompileStatic
class Conditions {

    /*
* Headers and Cookies are matched with a &quot;contains&quot; strategy, meaning that as long as the expected items are in the request, the match is accepted,
 * while the query strings, method name, path, and body are matched for equivalence.
     */

    /**
     * Provides a function that will return true if the request method equals the specified method.
     *
     * @param method the expected request method
     * @return true if the methods match
     */
    static final Function&lt;ClientRequest, Boolean&gt; methodEquals(final String method) {
<span class="pc" id="L41">        return new Function&lt;ClientRequest, Boolean&gt;() {</span>
            @Override Boolean apply(final ClientRequest clientRequest) {
<span class="pc" id="L43">                clientRequest.method.equalsIgnoreCase(method)</span>
            }
        }
    }

    /**
     * Provides a function that will return true if the request path equals the specified path.
     *
     * @param path the expected request path
     * @return true if the paths match
     */
    static final Function&lt;ClientRequest, Boolean&gt; pathEquals(final String path) {
<span class="pc" id="L55">        return new Function&lt;ClientRequest, Boolean&gt;() {</span>
            @Override Boolean apply(final ClientRequest clientRequest) {
<span class="pc" id="L57">                clientRequest.path == path</span>
            }
        }
    }

    /**
     * Provides a function that will return true if the request query string parameters match those provided. All of the expected parameter must be
     * present and they must be the only parameters present for the match to be accepted.
     *
     * @param queries the query string parameters as a map
     * @return true if the queries match (fully)
     */
    static final Function&lt;ClientRequest, Boolean&gt; queriesEquals(final Map&lt;String, List&lt;String&gt;&gt; queries) {
<span class="pc" id="L70">        return new Function&lt;ClientRequest, Boolean&gt;() {</span>
            @Override Boolean apply(final ClientRequest clientRequest) {
<span class="fc bfc" id="L72" title="All 2 branches covered.">                queries.every { k, v -&gt;</span>
<span class="pc bpc" id="L73" title="1 of 4 branches missed.">                    clientRequest.queryParams.containsKey(k) &amp;&amp; clientRequest.queryParams.get(k).containsAll(v)</span>
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">                } &amp;&amp; clientRequest.queryParams.every { k, v -&gt;</span>
<span class="pc bpc" id="L75" title="2 of 4 branches missed.">                    queries.containsKey(k) &amp;&amp; queries.get(k).containsAll(v)</span>
                }
            }
        }
    }

    /**
     * Provides a function that will return true if the request headers contain the provided headers and values. This map of headers is not inclusive,
     * but simply a check that the specified headers are present.
     *
     * @param headers the headers that must be in the request for a match
     * @return true if the specified headers are present (non-inclusive)
     */
    static final Function&lt;ClientRequest, Boolean&gt; headersContains(final Map&lt;String, String&gt; headers) {
<span class="pc" id="L89">        return new Function&lt;ClientRequest, Boolean&gt;() {</span>
            @Override Boolean apply(final ClientRequest clientRequest) {
<span class="pc" id="L91">                headers.every { k, v -&gt; v == clientRequest.headers.getFirst(k) }</span>
            }
        }
    }

    /**
     * Provides a function that will return true if the request cookies contain the provided cookies and values. This map of cookies is not inclusive,
     * but simply a check that the specified cookies are present.
     *
     * @param cookies the cookies that must be in the request for a match
     * @return true if the specified cookies are present (non-inclusive)
     */
    static final Function&lt;ClientRequest, Boolean&gt; cookiesContains(final Map&lt;String, String&gt; cookies) {
<span class="pc" id="L104">        return new Function&lt;ClientRequest, Boolean&gt;() {</span>
            @Override Boolean apply(final ClientRequest clientRequest) {
<span class="pc bpc" id="L106" title="1 of 4 branches missed.">                cookies.every { k, v -&gt; clientRequest.cookies.containsKey(k) &amp;&amp; v == clientRequest.cookies.get(k).value }</span>
            }
        }
    }

    /**
     * Provides a function that will return true if the request body content matches the client request body content converted using the specified
     * converter function.
     *
     * @param body the expected body content (converted form)
     * @param converter the function used to convert the client request content to the desired format
     * @return true if the body contents match
     */
    static final Function&lt;ClientRequest, Boolean&gt; bodyEquals(final Object body, final Function&lt;byte[], Object&gt; converter) {
<span class="pc" id="L120">        return new Function&lt;ClientRequest, Boolean&gt;() {</span>
            @Override Boolean apply(final ClientRequest clientRequest) {
<span class="pc" id="L122">                clientRequest.getBody(converter) == body</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>