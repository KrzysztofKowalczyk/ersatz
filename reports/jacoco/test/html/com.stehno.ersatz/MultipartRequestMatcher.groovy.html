<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MultipartRequestMatcher.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ersatz</a> &gt; <a href="index.source.html" class="el_package">com.stehno.ersatz</a> &gt; <span class="el_source">MultipartRequestMatcher.groovy</span></div><h1>MultipartRequestMatcher.groovy</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2018 Christopher J. Stehno
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.stehno.ersatz

import groovy.transform.CompileStatic
import org.hamcrest.BaseMatcher
import org.hamcrest.Description
import org.hamcrest.Matcher

import java.util.function.Consumer

import static com.stehno.ersatz.impl.Delegator.delegateTo
import static groovy.lang.Closure.DELEGATE_FIRST
import static org.hamcrest.Matchers.equalTo
import static org.hamcrest.Matchers.notNullValue
import static org.hamcrest.Matchers.startsWith

/**
 * A Hamcrest matcher used to match &lt;code&gt;MultipartRequestContent&lt;/code&gt;. The matcher may be created directly or by using the closure or consumer
 * static configuration methods.
 */
@CompileStatic
class MultipartRequestMatcher extends BaseMatcher&lt;MultipartRequestContent&gt; {

    private final Map&lt;String, Map&lt;String, Matcher&gt;&gt; matchers = [:]

    /**
     * Creates a new multipart matcher with a Groovy DSL closure (delegating to &lt;code&gt;MultipartRequestMatcher&lt;/code&gt;).
     *
     * @param the configuration closure
     * @return a configured matcher instance
     */
    static MultipartRequestMatcher multipartMatcher(@DelegatesTo(value = MultipartRequestMatcher, strategy = DELEGATE_FIRST) final Closure closure) {
<span class="pc" id="L47">        delegateTo(new MultipartRequestMatcher(), closure)</span>
    }

    /**
     * Creates a new multipart matcher with a consumer - it will have an instance of &lt;code&gt;MultipartRequestMatcher&lt;/code&gt; passed into it for
     * configuration of the matcher.
     *
     * @param the configuration consumer
     * @return a configured matcher instance
     */
    static MultipartRequestMatcher multipartMatcher(final Consumer&lt;MultipartRequestMatcher&gt; config) {
<span class="fc" id="L58">        MultipartRequestMatcher matcher = new MultipartRequestMatcher()</span>
<span class="fc" id="L59">        config.accept(matcher)</span>
<span class="pc" id="L60">        matcher</span>
    }

    /**
     * Applies a matcher to match when a part with the specified field name exists in the multipart request (and has a non-null value).
     *
     * @param fieldName the field name
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(final String fieldName) {
<span class="pc" id="L70">        part(fieldName, notNullValue())</span>
    }

    /**
     * Applies the specified content matcher to the part with the specified field name.
     *
     * @param fieldName the field name
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(final String fieldName, final Matcher&lt;Object&gt; value) {
<span class="fc" id="L81">        matchers[fieldName] = [value: value]</span>
<span class="pc" id="L82">        this</span>
    }

    /**
     * Applies a matcher for the field part value where the value must be equal to the specified value. This is simply an alias to calling
     * &lt;code&gt;part(fieldName, equalsTo(value))&lt;/code&gt;.
     *
     * @param fieldName the field name
     * @param value the field value
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(final String fieldName, final String value) {
<span class="pc" id="L94">        part fieldName, equalTo(value) as Matcher&lt;Object&gt;</span>
    }

    /**
     * Applies the specified content matcher and content-type matcher to the part with the specified field name.
     *
     * @param fieldName the field name
     * @param contentType the content type matcher
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(final String fieldName, final Matcher&lt;String&gt; contentType, final Matcher&lt;Object&gt; value) {
<span class="fc" id="L106">        matchers[fieldName] = [contentType: contentType, value: value]</span>
<span class="pc" id="L107">        this</span>
    }

    /**
     * Applies the specified content matcher matcher to the part with the specified field name and where the content type starts with the specified
     * string value. This is analogous to calling &lt;code&gt;part(fieldName, startsWith(contentType), value)&lt;/code&gt;.
     *
     * @param fieldName the field name
     * @param contentType the content type
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(final String fieldName, final String contentType, final Matcher&lt;Object&gt; value) {
<span class="pc" id="L120">        part fieldName, startsWith(contentType), value</span>
    }

    /**
     * Applies the specified content matcher matcher to the part with the specified field name and where the content type starts with the specified
     * string value. This is analogous to calling &lt;code&gt;part(fieldName, startsWith(contentType), value)&lt;/code&gt;.
     *
     * @param fieldName the field name
     * @param contentType the content type
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(final String fieldName, final ContentType contentType, final Matcher&lt;Object&gt; value) {
<span class="pc" id="L133">        part fieldName, contentType.value, value</span>
    }

    /**
     * Applies the specified content matcher, file name matcher and content-type matcher to the part with the specified field name.
     *
     * @param fieldName the field name
     * @param fileName the file name matcher
     * @param contentType the content type matcher
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(String fieldName, Matcher&lt;String&gt; fileName, Matcher&lt;String&gt; contentType, Matcher&lt;Object&gt; value) {
<span class="fc" id="L146">        matchers[fieldName] = [fileName: fileName, contentType: contentType, value: value]</span>
<span class="pc" id="L147">        this</span>
    }

    /**
     * Applies the value matcher to the part with the specified field name, where the file name must be equal to the given string, and the content
     * type must start with the specified value. This is analogous to calling:
     * &lt;code&gt;part(fieldName, equalTo(fileName), startsWith(contentType), value)&lt;/code&gt;
     *
     * @param fieldName the field name
     * @param fileName the file name
     * @param contentType the content type
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(String fieldName, String fileName, String contentType, Matcher&lt;Object&gt; value) {
<span class="pc" id="L162">        part fieldName, equalTo(fileName), startsWith(contentType), value</span>
    }

    /**
     * Applies the value matcher to the part with the specified field name, where the file name must be equal to the given string, and the content
     * type must start with the specified value. This is analogous to calling:
     * &lt;code&gt;part(fieldName, equalTo(fileName), startsWith(contentType.value), value)&lt;/code&gt;
     *
     * @param fieldName the field name
     * @param fileName the file name
     * @param contentType the content type
     * @param value the value matcher
     * @return a reference to this multipart request matcher
     */
    MultipartRequestMatcher part(String fieldName, String fileName, ContentType contentType, Matcher&lt;Object&gt; value) {
<span class="pc" id="L177">        part fieldName, fileName, contentType.value, value</span>
    }

    /**
     * Determines whether or not the given object matches the configured matchers.
     *
     * @param item the item being matched (must be an instance of MultipartRequestContent)
     * @return whether or not the match is accepted
     */
    @Override
    boolean matches(final Object item) {
<span class="fc bfc" id="L188" title="All 4 branches covered.">        if (!(item instanceof MultipartRequestContent)) {</span>
<span class="fc" id="L189">            return false</span>
        }

<span class="fc" id="L192">        def results = []</span>

<span class="fc" id="L194">        MultipartRequestContent mrc = item as MultipartRequestContent</span>

<span class="fc" id="L196">        matchers.each { String fn, Map&lt;String, Matcher&gt; matcher -&gt;</span>
<span class="fc" id="L197">            def part = mrc[fn]</span>

<span class="fc bfc" id="L199" title="All 4 branches covered.">            if (part) {</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">                if (matcher.fileName) {</span>
<span class="fc" id="L201">                    results &lt;&lt; matcher.fileName.matches(part.fileName)</span>
                }

<span class="fc bfc" id="L204" title="All 2 branches covered.">                if (matcher.contentType) {</span>
<span class="fc" id="L205">                    results &lt;&lt; matcher.contentType.matches(part.contentType)</span>
                }

<span class="pc bpc" id="L208" title="1 of 2 branches missed.">                if (matcher.value) {</span>
<span class="pc" id="L209">                    results &lt;&lt; matcher.value.matches(part.value)</span>
                }
            } else {
<span class="pc" id="L212">                results &lt;&lt; false</span>
            }
        }

<span class="pc" id="L216">        results.every()</span>
    }

    /**
     * Describes the matcher.
     *
     * @param description the description container
     */
    @Override
    void describeTo(final Description description) {
<span class="fc" id="L226">        description.appendText('MultipartRequestMatcher: ')</span>

<span class="fc" id="L228">        matchers.each { fn, map -&gt;</span>
<span class="pc" id="L229">            map.each { f, m -&gt;</span>
<span class="fc" id="L230">                description.appendText(&quot;${f}(&quot;)</span>
<span class="fc" id="L231">                m.describeTo(description)</span>
<span class="pc" id="L232">                description.appendText(') ')</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>